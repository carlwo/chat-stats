{% extends 'base.html' %}

{%- block content %}
  <div class="container">
  {%- if status == "OK": %}
    <br>
    <div class="has-text-right"><a class="tag is-medium" href="{{ url_for('exit') }}">Exit&nbsp;<button class="delete"></button></a></div>
    <h1 class="title">Chat Stats</h1>
    <h2 class="subtitle" id="subtitle">{{ message }}</h2>
    {%- if locked: %}
    <div class="notification is-warning is-light" id="notification_warning">
      <button class="delete" onclick="hide_notification('warning')"></button>
      <strong>Warning:</strong> There is a running download process with the url<br>
        {{ url }}<br>
        Please wait until the download is finished or terminate it by pressing the exit button.
    </div>
    {%- endif %}
    {%- if broadcast_type == 'livestream': %}
    <div class="notification" id="notification_info">
      <button class="delete" onclick="hide_notification('info')"></button>
      Press <em>Start</em> and <em>Stop</em> to get a <strong>ranking of the most frequent<br>
        chat messages</strong> of the given stream in that period of time.<br>
        Duplicate messages from the same author are ignored.
    </div>
    <div id="btn"><button class="button is-success" onclick="start()">Start</button></div>
    <br>
    {%- endif %}
    <div id="stats"></div>
  {%- else %} 
    <br>
    <br>
    <h1 class="title margin-top-0p25">Chat Stats</h1>
    <div class="notification is-danger is-light"><strong>Error:</strong> {{ message }}</div>
    <a class="tag is-medium" href="{{ url_for('exit') }}">Back</a>
  {%- endif %}
  </div>
{%- endblock %}

{%- block script %}
{%- if status == 'OK' and broadcast_type == 'past_broadcast': %}
<script>
function init() {
  start('past_broadcast');
}
if (document.readyState === 'loading') {  // Loading hasn't finished yet
  document.addEventListener('DOMContentLoaded', init);
} else {  // `DOMContentLoaded` has already fired
  init();
}
</script>
{%- endif %}
{%- endblock %}
